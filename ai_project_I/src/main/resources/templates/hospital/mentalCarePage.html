<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>심리케어</title>

    <!-- 공통 CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <!-- 페이지 전용 CSS -->
    <link rel="stylesheet" th:href="@{/css/mental-care.css}">

    <!-- (선택) CSRF -->
    <meta name="_csrf" th:content="${_csrf?.token}">
    <meta name="_csrf_header" th:content="${_csrf?.headerName}">

    <!-- Kakao 지도 SDK (내과/외과와 동일하게 키 직접 주입) -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=48475be29fda82ad232749bbb6f73ea1&libraries=services"></script>

    <!-- 페이지 전용 JS (SDK 뒤에 로드) -->
    <script defer th:src="@{/js/mental-care.js}"></script>
</head>
<body class="page--mental">
<!-- 헤더 프래그먼트 -->
<div th:replace="~{main/mainPage:: header}"></div>

<div class="main-wrapper">

    <!-- 상단 헤더 (내과/외과 느낌) -->
    <div class="page-header">
        <div class="header-icon">🧠</div>
        <h1>심리케어</h1>
        <p>AI 상담과 표준화된 자가진단으로 마음 건강을 살펴보세요</p>
    </div>

    <!-- 본문: 좌측 설문 / 우측 챗봇 -->
    <div class="content-container">
        <!-- 설문 -->
        <main class="survey-container">
            <div class="progress-bar-container">
                <span class="progress-text">진행률</span>
                <div class="progress-bar"><div class="progress" id="cesd-progress" style="width:5%;"></div></div>
                <span class="step-text" id="cesd-step-text">1/20</span>
            </div>

            <section id="cesd-box" class="survey-step">
                <h2>CES-D 우울증 자가진단</h2>

                <div id="cesd-question" class="mc-qbox"></div>
                <div id="cesd-options" class="mc-options"></div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" id="cesd-prev" disabled>이전</button>
                    <button type="button" class="btn-primary" id="cesd-next">다음</button>
                </div>

                <div id="cesd-result" class="mc-result" style="display:none;">
                    <div class="result-card">
                        <div class="result-header">
                            <h3 id="cesd-level-title">결과</h3>
                            <span class="urgency-badge" id="cesd-badge">정상</span>
                        </div>
                        <div class="risk-score">
                            <p>총점 (0–60)</p>
                            <div class="progress-bar-small">
                                <div class="progress-fill" id="cesd-scorebar" style="width:0%;"></div>
                            </div>
                            <span id="cesd-score-text">0 / 60</span>
                        </div>
                        <p id="cesd-desc" class="mc-muted"></p>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn-secondary" id="cesd-reset">다시하기</button>
                        <button type="button" class="btn-primary" id="cesd-save">결과 저장</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- 챗봇 -->
        <aside class="mental-chat-container">
            <div class="mc-chat-card">
                <h3 class="mc-card-title">AI 심리상담</h3>
                <div id="mc-chat-list" class="mc-chat__list"></div>
                <div class="mc-chat__input">
                    <input id="mc-chat-input" class="mc-input" type="text" placeholder="지금 마음 상태를 편하게 적어보세요. 예) 요즘 잠이 잘 안 와요">
                    <button id="mc-chat-send" class="btn-primary">보내기</button>
                </div>
            </div>
        </aside>
    </div>

    <!-- 하단: 자동 지도(검색 UI 없음) -->
    <div class="nearby-hospital-section">
        <div class="nearby-hospital-header">
            <h4>주변 정신건강의학과</h4>
        </div>
        <div id="map-container"></div>
        <div class="hospital-grid" id="nearby-hospitals-list"></div>
    </div>
</div>

<!-- 푸터 프래그먼트 -->
<div th:replace="~{main/mainPage:: footer}"></div>
</body>
</html>
